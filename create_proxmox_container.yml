---
- name: Update web servers
  hosts: proxmox_servers

  tasks:
  - name: Install Python3-pip
    ansible.builtin.apt:
      name: python3-pip
      state: present
  # - name: Install setuptools modules via pip
  #   ansible.builtin.pip:
  #     name: setuptools
  #     state: present
  # - name: Install requests module via pip
  #   ansible.builtin.pip:
  #     name: requests
  #     state: present
  # - name: install proxmoxer module via pip
  #   ansible.builtin.pip:
  #     name: proxmoxer
  #     state: present
  - name: Create new container automatically selecting the next available vmid.
    community.general.proxmox:
      node: 'proxmox2-smartlink'
      vmid: "{{container_id}}"
      api_user: 'root@pam'
      api_password: "{{ proxmox_pass}}"
      api_host: 157.15.58.25
      password: "{{ proxmox_pass }}"
      hostname: "{{ container_hostname }}"
      ostemplate: local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst
      disk: 'local-lvm:20'
      netif:
        net0: "name=eth0,gw=10.80.28.1,ip=10.80.28.105/24,bridge=vmbr0"

  - name: Start container
    community.general.proxmox:
      vmid: "{{container_id}}"
      api_user: 'root@pam'
      api_password: "{{ proxmox_pass}}"
      api_host: 157.15.58.25
      state: started